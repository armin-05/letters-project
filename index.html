<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>File App</title>
<style>
  body {
    background: #222;
    height: 100vh;
    margin: 0;
    overflow: hidden;
    font-family: sans-serif;
  }

  /* FILE APP WINDOW */
  .file-window {
    position: absolute;
    top: 100px;
    left: 100px;
    width: 400px;
    height: 300px;
    background: #888;
    border: 2px solid #444;
    display: flex;
    flex-direction: column;
    resize: both;
    overflow: hidden;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
  }

  .file-topbar {
    background: #555;
    color: white;
    padding: 4px 10px;
    cursor: move;
    display: flex;
    align-items: center;
    user-select: none;
  }

  .file-icon {
    width: 16px;
    height: 16px;
    background: url('file_00000000d87c61f492ae966a71d8ec6e.png') no-repeat center/cover;
    margin-right: 8px;
  }

  .note-content {
    flex: 1;
    padding: 10px;
    overflow: auto;
    background: #777;
    color: white;
    white-space: pre-wrap;
    outline: none;
    font-size: 14px;
  }

  /* Highlight colors */
  .match-exact {
    color: #00ff00;
    transition: color 0.5s ease;
  }

  .match-case {
    color: #66ff66;
    transition: color 0.5s ease;
  }

  .match-wrong {
    color: yellow;
  }

  /* Fade-out animation for green text */
  @keyframes fadeToWhite {
    0% { color: inherit; }
    100% { color: white; }
  }

  .fade-out {
    animation: fadeToWhite 1s forwards;
  }

  /* Resize handle */
  .resize-handle {
    position: absolute;
    width: 10px;
    height: 10px;
    bottom: 2px;
    right: 2px;
    background: #ccc;
    border-radius: 50%;
    cursor: se-resize;
  }
</style>
</head>
<body>

<div class="file-window" id="fileApp">
  <div class="file-topbar" id="fileTop">
    <div class="file-icon"></div>
    File.txt
  </div>
  <div class="note-content" id="noteContent" contenteditable="true"></div>
  <div class="resize-handle" id="resizeHandle"></div>
</div>

<script>
  const fileApp = document.getElementById('fileApp');
  const fileTop = document.getElementById('fileTop');
  const noteContent = document.getElementById('noteContent');
  const resizeHandle = document.getElementById('resizeHandle');

  /* Bring to front on click */
  let zIndexCounter = 10;
  fileApp.addEventListener('mousedown', () => {
    fileApp.style.zIndex = ++zIndexCounter;
  });

  /* Make window draggable */
  let offsetX, offsetY, isDragging = false;
  fileTop.addEventListener('mousedown', (e) => {
    isDragging = true;
    offsetX = e.clientX - fileApp.offsetLeft;
    offsetY = e.clientY - fileApp.offsetTop;
    fileApp.style.zIndex = ++zIndexCounter;
  });
  document.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    fileApp.style.left = e.clientX - offsetX + 'px';
    fileApp.style.top = e.clientY - offsetY + 'px';
  });
  document.addEventListener('mouseup', () => isDragging = false);

  /* Resize handle logic */
  let isResizing = false, startX, startY, startWidth, startHeight;
  resizeHandle.addEventListener('mousedown', (e) => {
    e.preventDefault();
    isResizing = true;
    startX = e.clientX;
    startY = e.clientY;
    startWidth = parseInt(document.defaultView.getComputedStyle(fileApp).width, 10);
    startHeight = parseInt(document.defaultView.getComputedStyle(fileApp).height, 10);
    fileApp.style.zIndex = ++zIndexCounter;
  });
  document.addEventListener('mousemove', (e) => {
    if (!isResizing) return;
    fileApp.style.width = startWidth + (e.clientX - startX) + 'px';
    fileApp.style.height = startHeight + (e.clientY - startY) + 'px';
  });
  document.addEventListener('mouseup', () => isResizing = false);

  /* Highlight logic */
  const targetText = `Chapter 151: Demonic nature
“What?” Gu Yue Yao Le was shocked when she heard this.
Fang Yuan had already struck at lightning speed, his hand chopping her
neck! She fainted immediately.
The young girl fell down helplessly, and Fang Yuan’s hand quickly moved,
holding her by the waist. Next, he activated the Stealth Scale Gu, and their
bodies vanished on the spot.
When Gu Yue Yao Le woke up in a sleepy state, she found herself in a dark
mountain cave.
She shrugged her head, trying to stand up subconsciously.
But she soon found out that her arms were tied behind her back, the rope
looped around her neck; she was tied tightly on a large rock.
All the Gu worms on her body had been plundered away by Fang Yuan,
refined and turned into his.
She was merely a fifteen year old young girl — with that frail body, how
could she break free from that thick ropes wrapped a few times around the
rock, even tied with knots?
Being trapped in this remote and unfamiliar place, the young girl started to
feel frightened.
She thought about the moment before she had fainted; even the most naive
person would also know that Fang Yuan was going to do something bad to
her.`;

  const initialVisibleText = `Chapter 151: Demonic nature
“What?” Gu Yue Yao Le was shoc`;

  function scheduleGreenFade(span) {
    setTimeout(() => {
      span.classList.add('fade-out');
    }, 5000); // fade after 5s
  }

  function renderNoteHighlights(rawText) {
    noteContent.innerHTML = '';
    for (let i = 0; i < rawText.length; i++) {
      const ch = rawText[i];
      const expected = targetText[i] ?? null;
      const span = document.createElement('span');
      span.textContent = ch;
      if (expected === null) {
        span.className = 'match-wrong';
      } else if (ch === expected) {
        span.className = 'match-exact';
        scheduleGreenFade(span);
      } else if (ch.toLowerCase() === expected.toLowerCase()) {
        span.className = 'match-case';
        scheduleGreenFade(span);
      } else {
        span.className = 'match-wrong';
      }
      noteContent.appendChild(span);
    }
  }

  function placeCaretAtEnd(el) {
    el.focus();
    if (typeof window.getSelection != "undefined" && typeof document.createRange != "undefined") {
      const range = document.createRange();
      range.selectNodeContents(el);
      range.collapse(false);
      const sel = window.getSelection();
      sel.removeAllRanges();
      sel.addRange(range);
    }
  }

  /* Initialize with partial visible text */
  renderNoteHighlights(initialVisibleText);
  placeCaretAtEnd(noteContent);
</script>
</body>
</html>
