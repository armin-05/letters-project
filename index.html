<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mini Desktop OS — Notepad Upgrade</title>

<style>
  :root{
    --bg-black:#000;
    --note-bg:#e6e6e6; /* main window grey */
    --note-top:#9a9a9a; /* darker top bar */
    --dark-green:#1e7f34; /* exact-match */
    --light-green:#9cff8a; /* case-diff match */
    --wrong-yellow:#fff666;
    --window-min-w:280px;
    --window-min-h:200px;
  }

  html,body{height:100%;margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg-black);overflow:hidden;}

  /* ---------- kakao icon (original) ---------- */
  #icon{
    position:absolute; top:60px; left:60px;
    width:70px; height:80px; cursor:grab;
  }

  /* ---------- note icon ---------- */
  #noteIcon{
    position:absolute; top:60px; left:160px;
    width:70px; height:80px; cursor:grab;
  }

  /* ---------- generic window base ---------- */
  .appWindow{
    position:absolute;
    display:none;
    border-radius:8px;
    box-shadow:0 6px 18px rgba(0,0,0,0.6);
    overflow:hidden;
    user-select:none;
    min-width:var(--window-min-w);
    min-height:var(--window-min-h);
    background:white;
  }

  /* ---------- kakao window (kept minimal) ---------- */
  #kakaoWindow{ top:150px; left:150px; width:420px; height:340px; }
  #kakaoTopBar{ height:40px; background:transparent; cursor:grab; }
  #kakaoImage{ display:block; max-width:100%; max-height:100%; }

  /* ---------- NOTE Window Design ---------- */
  #noteWindow{
    top:140px; left:260px;
    width:520px;      /* bigger default width */
    height:420px;     /* bigger default height */
    background:var(--note-bg);
  }

  /* top bar darker grey */
  #noteTopBar{
    height:42px;
    width:100%;
    background:var(--note-top);
    cursor:grab;
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:0 10px;
    box-sizing:border-box;
  }

  #noteTitle{
    color:#fff; font-weight:600; font-size:14px;
    pointer-events:none;
  }

  #noteCloseBtn{
    width:26px; height:26px; border-radius:50%; border:none; background:#d94c4c; cursor:pointer;
  }

  /* highlight output area (the "visual" text) */
  #highlightOutput{
    position:absolute;
    top:54px; left:12px; right:12px;
    bottom:90px;
    padding:8px;
    box-sizing:border-box;
    font-family:monospace;
    font-size:16px;
    line-height:1.25;
    white-space:pre-wrap;
    overflow:auto;
    background:transparent;
    border-radius:6px;
    color:#000;
  }

  /* the actual typing area */
  #noteTypingArea{
    position:absolute;
    left:12px; right:12px; bottom:12px;
    height:66px;
    box-sizing:border-box;
    resize:none;
    font-family:monospace;
    font-size:16px;
    padding:8px;
    border-radius:6px;
    border:1px solid rgba(0,0,0,0.12);
    outline:none;
    background:rgba(255,255,255,0.9);
    color:#000;
  }

  /* Resizer handles */
  .resizer{
    position:absolute;
    background:transparent;
    z-index:40;
  }
  .resizer.right{ top:8px; right:0; bottom:8px; width:8px; cursor:e-resize; }
  .resizer.bottom{ left:8px; right:8px; bottom:0; height:8px; cursor:s-resize; }
  .resizer.br{ right:0; bottom:0; width:14px; height:14px; cursor:se-resize; }
  .resizer.bl{ left:0; bottom:0; width:14px; height:14px; cursor:sw-resize; }

  /* small visual guide for handles (optional) */
  .resizer:after{
    content:"";
    position:absolute;
    right:3px; bottom:3px;
    width:6px; height:6px;
    background:rgba(0,0,0,0.12);
    border-radius:2px;
  }

  /* messages styling (kakao messages) — untouched */
  #messageContainer{ position:absolute; top:115px; left:10px; right:10px; bottom:147px; overflow:auto; }
  .message{ display:inline-block; padding:8px 12px; border-radius:12px; margin:4px 0; max-width:70%; word-wrap:break-word; font-size:14px; }
  .messageContainer{ display:flex; margin-bottom:4px; }
  .userMsg{ justify-content:flex-end; }
  .userMsg .message{ background-color:#ffeb00; color:#000; }
  .botMsg{ justify-content:flex-start; }
  .botMsg .message{ background-color:#ececec; color:#000; }

  /* small selection prevention for the whole document except inputs */
  *{ -webkit-user-select: none; -moz-user-select: none; -ms-user-select:none; user-select:none; }
  input, textarea{ user-select:text; -webkit-user-select:text; }

</style>
</head>
<body>

<!-- Kakao icon (placeholder - keep your existing filenames) -->
<img id="icon" src="Screenshot 2025-10-15 144240.png" alt="kakao">

<!-- Note icon (point to the notepad image you have) -->
<img id="noteIcon" src="notepad.png" alt="notepad">

<!-- Kakao window (kept but not modified for this iteration) -->
<div id="kakaoWindow" class="appWindow">
  <div id="kakaoTopBar"></div>
  <button id="closeBtn" title="close"></button>
  <img id="kakaoImage" src="Screenshot 2025-10-15 144717.png" alt="kakao image">
  <div id="messageContainer"></div>
  <textarea id="typingArea" placeholder=""></textarea>
  <button id="sendButton">Send</button>
</div>

<!-- NOTE Window -->
<div id="noteWindow" class="appWindow" role="application" aria-label="Note app">
  <div id="noteTopBar">
    <div id="noteTitle">Notepad</div>
    <button id="noteCloseBtn" aria-label="Close note"></button>
  </div>

  <div id="highlightOutput" aria-hidden="true"></div>

  <textarea id="noteTypingArea" placeholder="Type here..." spellcheck="false" aria-label="Type here"></textarea>

  <!-- Resizers -->
  <div class="resizer right"></div>
  <div class="resizer bottom"></div>
  <div class="resizer br"></div>
  <div class="resizer bl"></div>
</div>

<script>
/* ---------------------------
   Utilities
   --------------------------- */
function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }
function escapeHtml(s){
  return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")
          .replace(/"/g,"&quot;").replace(/'/g,"&#039;");
}
// ===== Kakao Window Behavior =====
const icon = document.getElementById('icon');
const kakaoWindow = document.getElementById('kakaoWindow');
const closeBtn = document.getElementById('closeBtn');

// open window on icon click
icon.addEventListener('click', () => {
  kakaoWindow.style.display = 'block';
});

// close window on close button click
closeBtn.addEventListener('click', () => {
  kakaoWindow.style.display = 'none';
});

/* ---------------------------
   Basic draggable icons
   --------------------------- */
function makeDraggableIcon(imgEl){
  let dragging=false, offX=0, offY=0;
  imgEl.addEventListener('mousedown', e=>{
    dragging=true;
    offX = e.offsetX;
    offY = e.offsetY;
    imgEl.style.cursor = 'grabbing';
  });
  document.addEventListener('mouseup', ()=>{ dragging=false; imgEl.style.cursor='grab'; });
  document.addEventListener('mousemove', e=>{
    if(!dragging) return;
    imgEl.style.left = (e.pageX - offX) + 'px';
    imgEl.style.top  = (e.pageY - offY) + 'px';
  });
}
makeDraggableIcon(document.getElementById('icon'));
makeDraggableIcon(document.getElementById('noteIcon'));

/* ---------------------------
   NOTE window behavior
   --------------------------- */
const noteWindow = document.getElementById('noteWindow');
const noteTopBar = document.getElementById('noteTopBar');
const noteCloseBtn = document.getElementById('noteCloseBtn');
const noteIcon = document.getElementById('noteIcon');
const noteTypingArea = document.getElementById('noteTypingArea');
const highlightOutput = document.getElementById('highlightOutput');
const resizerRight = noteWindow.querySelector('.resizer.right');
const resizerBottom = noteWindow.querySelector('.resizer.bottom');
const resizerBR = noteWindow.querySelector('.resizer.br');
const resizerBL = noteWindow.querySelector('.resizer.bl');

const MIN_W = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--window-min-w')) || 280;
const MIN_H = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--window-min-h')) || 200;

let draggingWindow=false, dragOffsetX=0, dragOffsetY=0;

// show window when icon clicked
noteIcon.addEventListener('click', ()=>{
  noteWindow.style.display = 'block';
  noteTypingArea.focus();
  updateHighlight();
});

// top bar drag (move window)
noteTopBar.addEventListener('mousedown', e=>{
  draggingWindow = true;
  const r = noteWindow.getBoundingClientRect();
  dragOffsetX = e.clientX - r.left;
  dragOffsetY = e.clientY - r.top;
  document.body.style.cursor = 'grabbing';
});
document.addEventListener('mouseup', ()=>{ draggingWindow=false; document.body.style.cursor='default'; });
document.addEventListener('mousemove', e=>{
  if(!draggingWindow) return;
  noteWindow.style.left = (e.clientX - dragOffsetX) + 'px';
  noteWindow.style.top  = (e.clientY - dragOffsetY) + 'px';
});

/* close button */
noteCloseBtn.addEventListener('click', ()=> {
  noteWindow.style.display = 'none';
});

/* ---------------------------
   Resizing logic
   - right: only width
   - bottom: only height
   - br: width + height
   - bl: change left & width + height
   --------------------------- */

function startResize(e, mode){
  e.preventDefault();
  const startRect = noteWindow.getBoundingClientRect();
  const startX = e.clientX;
  const startY = e.clientY;

  function onMove(ev){
    let dx = ev.clientX - startX;
    let dy = ev.clientY - startY;

    let newWidth = startRect.width;
    let newHeight = startRect.height;
    let newLeft = startRect.left;
    if(mode === 'right'){
      newWidth = clamp(startRect.width + dx, MIN_W, window.innerWidth - startRect.left - 8);
    } else if(mode === 'bottom'){
      newHeight = clamp(startRect.height + dy, MIN_H, window.innerHeight - startRect.top - 8);
    } else if(mode === 'br'){
      newWidth = clamp(startRect.width + dx, MIN_W, window.innerWidth - startRect.left - 8);
      newHeight = clamp(startRect.height + dy, MIN_H, window.innerHeight - startRect.top - 8);
    } else if(mode === 'bl'){
      // bottom-left: move left and change width + height
      newWidth = clamp(startRect.width - dx, MIN_W, startRect.left + startRect.width - 8);
      newLeft  = startRect.left + dx;
      // constrain left so window remains inside viewport
      if(newLeft < 0){ newLeft = 0; newWidth = startRect.right - 8; }
      newHeight = clamp(startRect.height + dy, MIN_H, window.innerHeight - startRect.top - 8);
    }

    // apply
    noteWindow.style.width = newWidth + 'px';
    noteWindow.style.height = newHeight + 'px';
    noteWindow.style.left = newLeft + 'px';
    // ensure top remains the same for these resizes
  }

  function onUp(){ document.removeEventListener('mousemove', onMove); document.removeEventListener('mouseup', onUp); }
  document.addEventListener('mousemove', onMove);
  document.addEventListener('mouseup', onUp);
}

resizerRight.addEventListener('mousedown', (e)=> startResize(e,'right'));
resizerBottom.addEventListener('mousedown', (e)=> startResize(e,'bottom'));
resizerBR.addEventListener('mousedown', (e)=> startResize(e,'br'));
resizerBL.addEventListener('mousedown', (e)=> startResize(e,'bl'));

/* ---------------------------
   Highlight logic with case-insensitive rules
   --------------------------- */

const targetText = "INSERT TEXT HERE"; // change to any text you want

// escape but preserve spaces and show them visibly? We'll render as usual.
function colorize(typed){
  // go char by char
  let out = '';
  for(let i=0;i<typed.length;i++){
    const ch = typed[i];
    const expected = targetText[i] ?? null;

    // safe printable HTML
    const safeCh = escapeHtml(ch);

    if(expected === null){
      // typed extra beyond expected length -> treat as wrong (yellow)
      out += `<span style="background:${getVar('--wrong-yellow')};padding:0 1px">${safeCh}</span>`;
      continue;
    }

    if(ch === expected){
      // exact match & exact case => dark green
      out += `<span style="background:${getVar('--dark-green')}; color:#fff; padding:0 1px">${safeCh}</span>`;
    } else if(ch.toLowerCase() === expected.toLowerCase()){
      // same letter but different case => light green (less saturated)
      out += `<span style="background:${getVar('--light-green')}; padding:0 1px">${safeCh}</span>`;
    } else {
      // mismatch
      out += `<span style="background:${getVar('--wrong-yellow')}; padding:0 1px">${safeCh}</span>`;
    }
  }
  return out;
}

// helper to read CSS variable values from :root and return actual hex string
function getVar(name){
  return getComputedStyle(document.documentElement).getPropertyValue(name).trim() || name;
}

function updateHighlight(){
  const typed = noteTypingArea.value;
  const safe = escapeHtml(typed);
  // produce colored markup
  highlightOutput.innerHTML = colorize(typed);

  // scroll highlightOutput to bottom so user sees latest as they type
  highlightOutput.scrollTop = highlightOutput.scrollHeight;
}

// update highlight whenever typing
noteTypingArea.addEventListener('input', updateHighlight);

// initialize with empty content
updateHighlight();

/* allow Enter/tab etc naturally inside textarea */
noteTypingArea.addEventListener('keydown', function(e){
  // allow tab insertion
  if(e.key === 'Tab'){
    e.preventDefault();
    const start = this.selectionStart;
    const end = this.selectionEnd;
    const value = this.value;
    this.value = value.substring(0,start) + '\t' + value.substring(end);
    this.selectionStart = this.selectionEnd = start + 1;
    updateHighlight();
  }
});

/* Keep focus on textarea if click anywhere inside the window */
noteWindow.addEventListener('mousedown', function(e){
  if(e.target === noteTypingArea) return;
  // small heuristic: if clicked inside window and not dragging handle, focus the textarea
  setTimeout(()=> noteTypingArea.focus(), 0);
});

/* resize on window resize to keep window inside viewport */
window.addEventListener('resize', ()=> {
  const r = noteWindow.getBoundingClientRect();
  const maxLeft = window.innerWidth - 40;
  const maxTop = window.innerHeight - 40;
  if(r.left > maxLeft) noteWindow.style.left = (maxLeft) + 'px';
  if(r.top  > maxTop) noteWindow.style.top = (maxTop) + 'px';
});

</script>
</body>
</html>
