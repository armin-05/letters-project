<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Desktop</title>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>
<style>
  :root {
    --bg-black: #000;
    --note-bg: #d3d3d3;
    --note-top: #8c8c8c;
    --green-exact: #1e7f34;
    --green-case: #9cff8a;
    --yellow-wrong: #ffeb66;
  }

  html, body {
    height: 100%;
    margin: 0;
    background: var(--bg-black);
    overflow: hidden;
    font-family: Arial, Helvetica, sans-serif;
  }

  /* Desktop Icons */
  .desktop-icon {
    position: absolute;
    width: 70px;
    height: 80px;
    cursor: grab;
  }
  .desktop-icon.dragging { cursor: grabbing; }
  #icon { top: 100px; left: 100px; }
  #noteIcon { top: 100px; left: 200px; }

  /* Window Base Styles */
  .window {
    position: absolute;
    border-radius: 8px;
    overflow: hidden;
    display: none;
    box-shadow: 0 6px 18px rgba(0,0,0,0.5);
  }

  .window-topbar {
    position: absolute;
    top: 0;
    left: 0;
    height: 40px;
    width: 100%;
    cursor: grab;
    z-index: 10;
  }
  .window-topbar.dragging { cursor: grabbing; }

  .window-close-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 32px;
    height: 32px;
    background: transparent;
    cursor: pointer;
    border: none;
    outline: none;
    z-index: 20;
  }

  /* KakaoTalk Window */
  #kakaoWindow {
    top: 200px;
    left: 200px;
  }
  #kakaoWindow .window-topbar { background: transparent; }
  #kakaoImage {
    display: block;
    width: auto;
    height: auto;
    max-width: 100%;
    max-height: 100%;
  }

  /* Kakao Message Area */
  #messageContainer {
    position: absolute;
    top: 115px;
    left: 10px;
    right: 10px;
    bottom: 147px;
    overflow-y: auto;
    z-index: 5;
  }

  .messageContainer {
    display: flex;
    margin-bottom: 4px;
  }
  .userMsg { justify-content: flex-end; }
  .botMsg { justify-content: flex-start; }

  .message {
    display: inline-block;
    padding: 8px 12px;
    border-radius: 12px;
    margin: 4px 0;
    max-width: 70%;
    word-wrap: break-word;
    font-size: 14px;
  }
  .userMsg .message {
    background-color: #ffeb00;
    color: black;
  }
  .botMsg .message {
    background-color: #ececec;
    color: black;
  }

  /* Kakao Input Area */
  #typingArea {
    position: absolute;
    left: 10px;
    bottom: 65px;
    width: calc(100% - 90px);
    height: 70px;
    font-size: 15px;
    color: black;
    background: transparent;
    border: none;
    outline: none;
    resize: none;
    z-index: 15;
  }

  #sendButton {
    position: absolute;
    right: 15px;
    bottom: 16px;
    width: 60px;
    height: 30px;
    font-weight: bold;
    color: black;
    background-color: #c0c0c0;
    border: none;
    border-radius: 4px;
    cursor: not-allowed;
    z-index: 16;
    transition: background-color .2s;
  }
  #sendButton.active {
    background-color: #ffeb00;
    cursor: pointer;
  }

  /* Call Buttons on Kakao Window */
  .call-button {
    position: absolute;
    top: 55px;
    width: 32px;
    height: 32px;
    background-color: rgba(255, 255, 255, 0.8);
    border: 1px solid #ccc;
    border-radius: 4px;
    cursor: pointer;
    z-index: 20;
    display: none;
  }
  #videoCallBtn {
    right: 50px;
    background: transparent;
    border: none;
    cursor: pointer;
  }
  #voiceCallBtn {
    right: 85px;
    background: transparent;
    border: none;
    cursor: pointer;
  }

  /* Call Windows */
  .call-window {
    position: absolute;
    display: none;
    box-shadow: 0 6px 18px rgba(0,0,0,0.5);
  }
  .call-window img {
    display: block;
    width: 100%;
    height: 100%;
  }
  .call-close-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 28px;
    height: 28px;
    background: transparent;
    cursor: pointer;
    border: none;
    z-index: 30;
  }
  .call-confirm-buttons {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 60px;
    display: flex;
    z-index: 25;
  }
  .call-confirm-btn {
    flex: 1;
    background: transparent;
    border: none;
    cursor: pointer;
  }
  .call-end-btn {
    position: absolute;
    bottom: 20px;
    left: calc(50% + 65px);
    width: 60px;
    height: 60px;
    background: transparent;
    border: none;
    cursor: pointer;
    z-index: 30;
  }

  /* Note Window */
  #noteWindow {
    top: 220px;
    left: 420px;
    width: 520px;
    height: 420px;
    background: var(--note-bg);
    min-width: 260px;
    min-height: 180px;
  }
  #noteWindow .window-topbar {
    height: 36px;
    background: var(--note-top);
  }
  #noteWindow .window-close-btn {
    width: 22px;
    height: 22px;
    background: #d94c4c;
    border-radius: 50%;
    top: 6px;
  }

  #noteContent {
    position: absolute;
    top: 44px;
    left: 10px;
    right: 10px;
    bottom: 10px;
    padding: 6px;
    box-sizing: border-box;
    font-family: monospace;
    font-size: 16px;
    line-height: 1.3;
    outline: none;
    background: transparent;
    white-space: pre-wrap;
    word-wrap: break-word;
    overflow: auto;
  }

  .resize-handle {
    position: absolute;
    right: 8px;
    bottom: 8px;
    width: 14px;
    height: 14px;
    background: radial-gradient(circle, #777 30%, transparent 31%);
    border-radius: 50%;
    cursor: nwse-resize;
    z-index: 60;
  }

  /* Highlight Classes */
  .match-exact {
    background: var(--green-exact);
    color: #fff;
    transition: background-color .3s;
  }
  .match-case {
    background: var(--green-case);
    color: #000;
    transition: background-color .3s;
  }
  .match-wrong {
    background: var(--yellow-wrong);
    color: #000;
  }
</style>
</head>
<body>

<!-- Desktop Icons -->
<img id="icon" class="desktop-icon" src="Screenshot 2025-10-15 144240.png" alt="Kakao Icon">
<img id="noteIcon" class="desktop-icon" src="notepad.png" alt="Note Icon">

<!-- KakaoTalk Window -->
<div id="kakaoWindow" class="window">
  <div class="window-topbar"></div>
  <button class="window-close-btn" title="close"></button>
  <button id="videoCallBtn" class="call-button" title="Video Call"></button>
  <button id="voiceCallBtn" class="call-button" title="Voice Call"></button>
  <img id="kakaoImage" src="Screenshot 2025-10-15 144717.png" alt="Kakao Window">
  <div id="messageContainer"></div>
  <textarea id="typingArea" placeholder="" spellcheck="false"></textarea>
  <button id="sendButton">Send</button>
</div>

<!-- Video Call Confirm Window -->
<div id="videoCallConfirm" class="call-window">
  <img src="videocall1.png" alt="Video Call Confirm">
  <button class="call-close-btn" title="close"></button>
  <div class="call-confirm-buttons">
    <button class="call-confirm-btn" data-action="accept"></button>
    <button class="call-confirm-btn" data-action="cancel"></button>
  </div>
</div>

<!-- Voice Call Confirm Window -->
<div id="voiceCallConfirm" class="call-window">
  <img src="voicecall1.png" alt="Voice Call Confirm">
  <button class="call-close-btn" title="close"></button>
  <div class="call-confirm-buttons">
    <button class="call-confirm-btn" data-action="accept"></button>
    <button class="call-confirm-btn" data-action="cancel"></button>
  </div>
</div>

<!-- Video Call Active Window -->
<div id="videoCallActive" class="call-window">
  <img src="videocall.png" alt="Video Call Active">
  <button class="call-close-btn" title="close"></button>
  <button class="call-end-btn" title="End Call"></button>
</div>

<!-- Voice Call Active Window -->
<div id="voiceCallActive" class="call-window">
  <img src="voicecall.png" alt="Voice Call Active">
  <button class="call-close-btn" title="close"></button>
  <button class="call-end-btn" title="End Call"></button>
</div>

<!-- Note Window -->
<div id="noteWindow" class="window">
  <div class="window-topbar"></div>
  <button class="window-close-btn" title="close"></button>
  <div id="noteContent" contenteditable="true" aria-label="Note editor"></div>
  <div class="resize-handle" title="resize"></div>
</div>

<script>
'use strict';

// ============================================================================
// CONSTANTS & STATE
// ============================================================================

const TARGET_TEXT = `November 4th
Dear Diary, I swear my girlfriend might be part cat. Shes either sleeping about to sleep or just woke up Every time I text her its sth like sorry i just woke up Or if Im lucky and shes feeling extra energetic she asks me about my day as well Its gotten to the point where Im not sure if Im dating a person or a hibernating bear. I once tried to surprise her with a call she didnt pick up Later she texted me that her phone died Sure it did Her phone dies more often than my motivation during exam week And her mom oh her mom Shes convinced Im a distraction Every time I come over she looks at me like Im the human embodiment of bad influence I swear shes plotting to replace me with a stack of textbooks The scary part My girlfriends slowly starting to sound like her The other day she was complaining i sleep too much I felt a chill down my spine But the worst part I cant even stay mad She ll text do you still love me and suddenly all logic flies out the window Im right back to smiling at my phone like an idiot Shes chaos naps and late replies but shes my chaos naps and late replies If loving her means waiting between naps dead phones and suspiciously long mom calls well I guess Ill just keep waiting`;

const DEFAULT_REPLIES = [
  "sorry, i just woke up. im sooo tired today",
  "i fell asleep again. wyd?",
  "Really? im soooo hungry tho",
  "do you still love me?",
  "sorry, fell asleep",
  "omg i was watching reels for hours lol",
  "wait what did u say??",
  "my phone died sorryyyy",
  "i was taking a nap hehe",
  "brb my mom is calling me",
  "hahahaha thats crazy",
  "im so bored rn",
  "ugh i have so much homework",
  "can we hang out soon?",
  "can we call real quick?",
  "i miss youuu thooooo"
];

const callState = {
  activeCallTimer: null,
  callType: null
};

let zIndexCounter = 100;
const greenTimers = new WeakMap();
const kakaoState = { 
  savedText: "", 
  messages: [],
  lastBotReply: null 
};

// ============================================================================
// UTILITY FUNCTIONS
// ============================================================================

function bringToFront(elem) {
  elem.style.zIndex = ++zIndexCounter;
}

function placeCaretAtEnd(el) {
  el.focus();
  const range = document.createRange();
  range.selectNodeContents(el);
  range.collapse(false);
  const sel = window.getSelection();
  sel.removeAllRanges();
  sel.addRange(range);
}

// ============================================================================
// DRAG FUNCTIONALITY
// ============================================================================

class DragHandler {
  constructor(element, handle = element) {
    this.element = element;
    this.handle = handle;
    this.isDragging = false;
    this.offsetX = 0;
    this.offsetY = 0;
    
    this.onMouseDown = this.onMouseDown.bind(this);
    this.onMouseMove = this.onMouseMove.bind(this);
    this.onMouseUp = this.onMouseUp.bind(this);
    
    this.handle.addEventListener('mousedown', this.onMouseDown);
  }

  onMouseDown(e) {
    this.isDragging = true;
    
    if (this.element.classList.contains('desktop-icon')) {
      this.offsetX = e.offsetX;
      this.offsetY = e.offsetY;
      this.element.classList.add('dragging');
    } else {
      const rect = this.element.getBoundingClientRect();
      this.offsetX = e.clientX - rect.left;
      this.offsetY = e.clientY - rect.top;
      this.handle.classList.add('dragging');
      bringToFront(this.element);
    }
    
    document.addEventListener('mousemove', this.onMouseMove);
    document.addEventListener('mouseup', this.onMouseUp);
  }

  onMouseMove(e) {
    if (!this.isDragging) return;
    
    if (this.element.classList.contains('desktop-icon')) {
      this.element.style.left = (e.pageX - this.offsetX) + 'px';
      this.element.style.top = (e.pageY - this.offsetY) + 'px';
    } else {
      this.element.style.left = (e.clientX - this.offsetX) + 'px';
      this.element.style.top = (e.clientY - this.offsetY) + 'px';
    }
  }

  onMouseUp() {
    this.isDragging = false;
    this.element.classList.remove('dragging');
    this.handle.classList.remove('dragging');
    document.removeEventListener('mousemove', this.onMouseMove);
    document.removeEventListener('mouseup', this.onMouseUp);
  }
}

// ============================================================================
// RESIZE FUNCTIONALITY
// ============================================================================

class ResizeHandler {
  constructor(window, handle) {
    this.window = window;
    this.handle = handle;
    this.minWidth = 260;
    this.minHeight = 180;
    
    this.handle.addEventListener('mousedown', (e) => this.startResize(e));
  }

  startResize(e) {
    e.preventDefault();
    bringToFront(this.window);
    
    const startRect = this.window.getBoundingClientRect();
    const startX = e.clientX;
    const startY = e.clientY;
    
    const onMove = (ev) => {
      const dx = ev.clientX - startX;
      const dy = ev.clientY - startY;
      this.window.style.width = Math.max(this.minWidth, startRect.width + dx) + 'px';
      this.window.style.height = Math.max(this.minHeight, startRect.height + dy) + 'px';
    };
    
    const onUp = () => {
      document.removeEventListener('mousemove', onMove);
      document.removeEventListener('mouseup', onUp);
    };
    
    document.addEventListener('mousemove', onMove);
    document.addEventListener('mouseup', onUp);
  }
}

// ============================================================================
// KAKAOTALK FUNCTIONALITY
// ============================================================================

class KakaoTalk {
  constructor() {
    this.window = document.getElementById('kakaoWindow');
    this.icon = document.getElementById('icon');
    this.topBar = this.window.querySelector('.window-topbar');
    this.closeBtn = this.window.querySelector('.window-close-btn');
    this.typingArea = document.getElementById('typingArea');
    this.sendButton = document.getElementById('sendButton');
    this.messageContainer = document.getElementById('messageContainer');
    this.videoCallBtn = document.getElementById('videoCallBtn');
    this.voiceCallBtn = document.getElementById('voiceCallBtn');
    
    this.init();
  }

  init() {
    new DragHandler(this.icon);
    new DragHandler(this.window, this.topBar);
    
    this.icon.addEventListener('click', () => this.open());
    this.closeBtn.addEventListener('click', () => this.close());
    this.typingArea.addEventListener('input', () => this.updateSendButton());
    this.typingArea.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        this.sendMessage();
      }
    });
    this.sendButton.addEventListener('click', () => this.sendMessage());
    this.window.addEventListener('mousedown', () => bringToFront(this.window));
    this.window.addEventListener('click', (e) => this.handleWindowClick(e));
    
    this.videoCallBtn.addEventListener('click', () => this.initiateCall('video'));
    this.voiceCallBtn.addEventListener('click', () => this.initiateCall('voice'));
  }

  initiateCall(type) {
    callState.callType = type;
    const confirmWindow = type === 'video' ? 
      document.getElementById('videoCallConfirm') : 
      document.getElementById('voiceCallConfirm');
    
    confirmWindow.style.display = 'block';
    confirmWindow.style.left = '300px';
    confirmWindow.style.top = '150px';
    bringToFront(confirmWindow);
  }

  open() {
    if (this.window.style.display === 'none' || !this.window.style.display) {
      this.window.style.display = 'block';
      bringToFront(this.window);
      this.typingArea.value = kakaoState.savedText;
      this.renderMessages();
      this.videoCallBtn.style.display = 'block';
      this.voiceCallBtn.style.display = 'block';
    }
  }

  close() {
    this.window.style.display = 'none';
    kakaoState.savedText = this.typingArea.value;
    this.typingArea.value = "";
    this.videoCallBtn.style.display = 'none';
    this.voiceCallBtn.style.display = 'none';
  }

  updateSendButton() {
    const hasText = this.typingArea.value.trim().length > 0;
    this.sendButton.classList.toggle('active', hasText);
    this.sendButton.disabled = !hasText;
  }

  sendMessage() {
    const text = this.typingArea.value.trim();
    if (!text) return;
    
    kakaoState.messages.push({ from: "user", text });
    this.typingArea.value = "";
    this.updateSendButton();
    this.renderMessages();
    
    const delay = Math.floor(Math.random() * (60000 - 10000 + 1)) + 10000;
    
    setTimeout(() => {
      const reply = this.getBotReply();
      kakaoState.messages.push({ from: "bot", text: reply });
      this.renderMessages();
    }, delay);
  }

  getBotReply() {
    let reply;
    const availableReplies = DEFAULT_REPLIES.filter(r => r !== kakaoState.lastBotReply);
    
    if (availableReplies.length === 0) {
      reply = DEFAULT_REPLIES[0];
    } else {
      reply = availableReplies[Math.floor(Math.random() * availableReplies.length)];
    }
    
    kakaoState.lastBotReply = reply;
    return reply;
  }

  renderMessages() {
    this.messageContainer.innerHTML = "";
    kakaoState.messages.forEach(msg => {
      const container = document.createElement('div');
      container.className = `messageContainer ${msg.from === "user" ? 'userMsg' : 'botMsg'}`;
      
      const bubble = document.createElement('div');
      bubble.className = 'message';
      bubble.textContent = msg.text;
      
      container.appendChild(bubble);
      this.messageContainer.appendChild(container);
    });
    this.messageContainer.scrollTop = this.messageContainer.scrollHeight;
  }

  handleWindowClick(e) {
    const rect = this.window.getBoundingClientRect();
    const clickFromBottom = rect.height - (e.clientY - rect.top);
    if (clickFromBottom < 110) {
      this.typingArea.focus();
      bringToFront(this.window);
    }
  }
}

// ============================================================================
// CALL MANAGER
// ============================================================================

class CallManager {
  constructor() {
    this.videoConfirm = document.getElementById('videoCallConfirm');
    this.voiceConfirm = document.getElementById('voiceCallConfirm');
    this.videoActive = document.getElementById('videoCallActive');
    this.voiceActive = document.getElementById('voiceCallActive');
    this.kakaoTalk = null;
    
    this.init();
  }

  init() {
    [this.videoConfirm, this.voiceConfirm, this.videoActive, this.voiceActive].forEach(win => {
      new DragHandler(win, win);
      win.addEventListener('mousedown', () => bringToFront(win));
    });

    this.setupConfirmWindow(this.videoConfirm, 'video');
    this.setupConfirmWindow(this.voiceConfirm, 'voice');
    this.setupActiveWindow(this.videoActive, 'video');
    this.setupActiveWindow(this.voiceActive, 'voice');
  }

  setupConfirmWindow(window, type) {
    const closeBtn = window.querySelector('.call-close-btn');
    const buttons = window.querySelectorAll('.call-confirm-btn');
    
    closeBtn.addEventListener('click', () => {
      window.style.display = 'none';
    });
    
    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        const action = btn.getAttribute('data-action');
        if (action === 'accept') {
          this.acceptCall(type);
        } else {
          window.style.display = 'none';
        }
      });
    });
  }

  setupActiveWindow(window, type) {
    const closeBtn = window.querySelector('.call-close-btn');
    const endBtn = window.querySelector('.call-end-btn');
    
    const endCall = (userEnded = true) => {
      if (callState.activeCallTimer) {
        clearTimeout(callState.activeCallTimer);
        callState.activeCallTimer = null;
      }
      window.style.display = 'none';
      
      const message = userEnded ? 
        "why did you call me????" : 
        "sorryyyyyy, i cant call right now baby";
      
      setTimeout(() => {
        kakaoState.messages.push({ from: "bot", text: message });
        const messageContainer = document.getElementById('messageContainer');
        messageContainer.innerHTML = "";
        kakaoState.messages.forEach(msg => {
          const container = document.createElement('div');
          container.className = `messageContainer ${msg.from === "user" ? 'userMsg' : 'botMsg'}`;
          
          const bubble = document.createElement('div');
          bubble.className = 'message';
          bubble.textContent = msg.text;
          
          container.appendChild(bubble);
          messageContainer.appendChild(container);
        });
        messageContainer.scrollTop = messageContainer.scrollHeight;
      }, 500);
    };
    
    closeBtn.addEventListener('click', () => endCall(true));
    endBtn.addEventListener('click', () => endCall(true));
    
    window._endCall = endCall;
  }

  acceptCall(type) {
    if (type === 'video') {
      this.videoConfirm.style.display = 'none';
      this.videoActive.style.display = 'block';
      this.videoActive.style.left = '300px';
      this.videoActive.style.top = '150px';
      bringToFront(this.videoActive);
      
      callState.activeCallTimer = setTimeout(() => {
        this.videoActive._endCall(false);
      }, 30000);
    } else {
      this.voiceConfirm.style.display = 'none';
      this.voiceActive.style.display = 'block';
      this.voiceActive.style.left = '300px';
      this.voiceActive.style.top = '150px';
      bringToFront(this.voiceActive);
      
      callState.activeCallTimer = setTimeout(() => {
        this.voiceActive._endCall(false);
      }, 30000);
    }
  }
}

// ============================================================================
// NOTE WINDOW FUNCTIONALITY
// ============================================================================

class NoteWindow {
  constructor() {
    this.window = document.getElementById('noteWindow');
    this.icon = document.getElementById('noteIcon');
    this.topBar = this.window.querySelector('.window-topbar');
    this.closeBtn = this.window.querySelector('.window-close-btn');
    this.content = document.getElementById('noteContent');
    this.resizeHandle = this.window.querySelector('.resize-handle');
    
    this.init();
  }

  init() {
    new DragHandler(this.icon);
    new DragHandler(this.window, this.topBar);
    new ResizeHandler(this.window, this.resizeHandle);
    
    this.icon.addEventListener('click', () => this.open());
    this.closeBtn.addEventListener('click', () => this.close());
    this.window.addEventListener('mousedown', () => bringToFront(this.window));
    this.content.addEventListener('input', () => this.handleInput());
    this.content.addEventListener('keydown', (e) => this.handleKeydown(e));
    
    // Initialize with first 50 characters and open the window
    const initialText = TARGET_TEXT.substring(0, 150);
    this.renderHighlights(initialText);
    placeCaretAtEnd(this.content);
    this.window.style.display = 'block';
    bringToFront(this.window);
  }

  open() {
    this.window.style.display = 'block';
    bringToFront(this.window);
    placeCaretAtEnd(this.content);
  }

  close() {
    this.window.style.display = 'none';
  }

  handleInput() {
    const text = this.content.innerText.replace(/\uFEFF/g, '');
    const caretPos = this.getCaretPosition();
    this.renderHighlights(text);
    this.setCaretPosition(caretPos);
  }

  getCaretPosition() {
    const sel = window.getSelection();
    if (sel.rangeCount === 0) return 0;
    
    const range = sel.getRangeAt(0);
    const preCaretRange = range.cloneRange();
    preCaretRange.selectNodeContents(this.content);
    preCaretRange.setEnd(range.endContainer, range.endOffset);
    
    return preCaretRange.toString().length;
  }

  setCaretPosition(pos) {
    const sel = window.getSelection();
    let charCount = 0;
    let foundPos = false;
    
    const walkNodes = (node) => {
      if (foundPos) return;
      
      if (node.nodeType === Node.TEXT_NODE) {
        const nextCharCount = charCount + node.length;
        if (pos <= nextCharCount) {
          const range = document.createRange();
          range.setStart(node, pos - charCount);
          range.collapse(true);
          sel.removeAllRanges();
          sel.addRange(range);
          foundPos = true;
          return;
        }
        charCount = nextCharCount;
      } else {
        for (let i = 0; i < node.childNodes.length; i++) {
          walkNodes(node.childNodes[i]);
          if (foundPos) return;
        }
      }
    };
    
    walkNodes(this.content);
    
    if (!foundPos) {
      placeCaretAtEnd(this.content);
    }
  }

  handleKeydown(e) {
    if (e.key === 'Tab') {
      e.preventDefault();
      const caretPos = this.getCaretPosition();
      const text = this.content.innerText;
      const newText = text.slice(0, caretPos) + '\t' + text.slice(caretPos);
      this.renderHighlights(newText);
      this.setCaretPosition(caretPos + 1);
    }
  }

  renderHighlights(text) {
    this.content.innerHTML = '';
    
    for (let i = 0; i < text.length; i++) {
      const ch = text[i];
      const expected = TARGET_TEXT[i] ?? null;
      const span = document.createElement('span');
      span.textContent = ch;
      
      if (expected === null) {
        span.className = 'match-wrong';
      } else if (ch === expected) {
        span.className = 'match-exact';
        this.scheduleGreenFade(span);
      } else if (ch.toLowerCase() === expected.toLowerCase()) {
        span.className = 'match-case';
        this.scheduleGreenFade(span);
      } else {
        span.className = 'match-wrong';
      }
      
      this.content.appendChild(span);
    }
  }

  scheduleGreenFade(span) {
    const existingTimer = greenTimers.get(span);
    if (existingTimer) clearTimeout(existingTimer);
    
    const timer = setTimeout(() => {
      span.classList.remove('match-exact', 'match-case');
      span.style.background = 'transparent';
      greenTimers.delete(span);
    }, 5000);
    
    greenTimers.set(span, timer);
  }
}

// ============================================================================
// INITIALIZATION
// ============================================================================
document.addEventListener('DOMContentLoaded', () => {
  new KakaoTalk();
  new CallManager();
  new NoteWindow();
});
</script>
</body>
</html>