<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ecologies from Cadence</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    height: 100%;
    background: #111;
    user-select: none;
    font-family: sans-serif;
    color: #fff;
  }
  canvas { display:block; }
  #instructions {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(0,0,0,0.7);
    padding: 10px;
    border-radius: 8px;
    max-width: 300px;
  }
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<div id="instructions">
  <b>Ecologies from Cadence:</b><br>
  Type to spawn agents:<br>
  - Fast typing → swarming fireflies<br>
  - Long key press → slow growing trees/seeds<br>
  - Backspace → predator eats nearest agent<br>
  Mouse → spawn location / attract agents<br>
  Click → local bloom effect
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

window.addEventListener('resize', ()=>{
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});

let agents = [];
let predators = [];
let blooms = [];
let lastKeyTime = Date.now();
let holdStart = null;

// Agent types: firefly, seed/tree
class Agent {
  constructor(x,y,type){
    this.x = x;
    this.y = y;
    this.vx = Math.random()*2-1;
    this.vy = Math.random()*2-1;
    this.type = type;
    this.life = 1; // 0-1 normalized
    this.size = type==='firefly'?4:10;
    this.color = type==='firefly'?'yellow':'green';
  }
  update(){
    // simple movement
    if(this.type==='firefly'){
      this.vx += (Math.random()-0.5)*0.2;
      this.vy += (Math.random()-0.5)*0.2;
      this.x += this.vx;
      this.y += this.vy;
      // wrap around edges
      if(this.x>canvas.width) this.x=0;
      if(this.x<0) this.x=canvas.width;
      if(this.y>canvas.height) this.y=0;
      if(this.y<0) this.y=canvas.height;
    } else if(this.type==='seed'){
      // slow growing tree effect
      this.vx = 0;
      this.vy = -0.1;
      this.x += this.vx;
      this.y += this.vy;
      this.size += 0.05; // growth
      if(this.size>30) this.size=30;
    }

    // life decay
    this.life -= 0.001;
  }
  draw(){
    ctx.fillStyle = this.color;
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.size*this.life,0,Math.PI*2);
    ctx.fill();
  }
}

// Predator (backspace)
class Predator {
  constructor(x,y){
    this.x = x;
    this.y = y;
    this.size = 20;
    this.color = 'red';
  }
  update(){
    // move towards nearest agent
    if(agents.length>0){
      let nearest = agents.reduce((a,b)=>distance(this,b)<distance(this,a)?b:a);
      let dx = nearest.x - this.x;
      let dy = nearest.y - this.y;
      let dist = Math.sqrt(dx*dx+dy*dy);
      if(dist>0){
        this.x += dx/dist*2;
        this.y += dy/dist*2;
      }
      // eat if close
      if(dist<10){
        agents.splice(agents.indexOf(nearest),1);
      }
    }
  }
  draw(){
    ctx.fillStyle = this.color;
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
    ctx.fill();
  }
}

// Bloom effect (on click)
class Bloom {
  constructor(x,y){
    this.x = x;
    this.y = y;
    this.radius = 0;
    this.maxRadius = 50;
  }
  update(){
    this.radius += 2;
    if(this.radius>this.maxRadius) this.radius=0;
  }
  draw(){
    ctx.strokeStyle = `rgba(255,255,255,0.3)`;
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.radius,0,Math.PI*2);
    ctx.stroke();
  }
}

function distance(a,b){
  return Math.sqrt((a.x-b.x)**2 + (a.y-b.y)**2);
}

// Event listeners
document.addEventListener('keydown', e=>{
  const now = Date.now();
  const dt = now - lastKeyTime;
  lastKeyTime = now;
  holdStart = now;

  if(e.key==='Backspace'){
    predators.push(new Predator(canvas.width/2, canvas.height/2));
    e.preventDefault();
    return;
  }

  // Short dt = fast typing → firefly
  if(dt<200){
    for(let i=0;i<3;i++){
      agents.push(new Agent(mouseX,mouseY,'firefly'));
    }
  } else { 
    // longer dt → seed/tree
    agents.push(new Agent(mouseX,mouseY,'seed'));
  }
});

document.addEventListener('keyup', e=>{
  holdStart = null;
});

let mouseX = canvas.width/2;
let mouseY = canvas.height/2;

canvas.addEventListener('mousemove', e=>{
  mouseX = e.clientX;
  mouseY = e.clientY;
});

canvas.addEventListener('click', e=>{
  blooms.push(new Bloom(e.clientX,e.clientY));
});

// Animation loop
function animate(){
  ctx.fillStyle='rgba(0,0,0,0.2)';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Update and draw agents
  for(let i=agents.length-1;i>=0;i--){
    agents[i].update();
    if(agents[i].life<=0) agents.splice(i,1);
    else agents[i].draw();
  }

  // Update and draw predators
  predators.forEach(p=>{
    p.update();
    p.draw();
  });

  // Update and draw blooms
  for(let i=blooms.length-1;i>=0;i--){
    blooms[i].update();
    blooms[i].draw();
    if(blooms[i].radius===0) blooms.splice(i,1);
  }

  requestAnimationFrame(animate);
}

animate();
</script>
</body>
</html>
