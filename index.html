<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Weather Composer</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    height: 100%;
    background: #87ceeb; /* sky blue */
    font-family: sans-serif;
    user-select: none;
  }
  canvas {
    display: block;
  }
  #instructions {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(255,255,255,0.7);
    padding: 10px;
    border-radius: 8px;
  }
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<div id="instructions">
  <b>Weather Composer Controls:</b><br>
  W = Wind / gust<br>
  C = Clouds (hold for denser clouds)<br>
  R = Rain toggle<br>
  S = Snow toggle<br>
  T = Thunder / lightning<br>
  M = Mist / fog<br>
  Mouse = Position weather effects<br>
  Click = Local storm spawn
</div>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

window.addEventListener('resize', () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});

// Weather state
let wind = 0;
let cloudDensity = 0;
let rain = false;
let snow = false;
let mist = false;
let lightning = false;

// Particles
const clouds = [];
const raindrops = [];
const snowflakes = [];
const mists = [];
const storms = [];

// Helpers
function random(min,max){return Math.random()*(max-min)+min;}

// Cloud particle
class Cloud {
  constructor(x,y,size){
    this.x = x;
    this.y = y;
    this.size = size;
    this.speed = random(0.2,0.7);
  }
  update(){
    this.x += this.speed + wind;
    if(this.x > canvas.width+100) this.x = -100;
  }
  draw(){
    ctx.fillStyle = `rgba(255,255,255,0.5)`;
    ctx.beginPath();
    ctx.ellipse(this.x,this.y,this.size*2,this.size,0,0,2*Math.PI);
    ctx.fill();
  }
}

// Rain particle
class Rain {
  constructor(x,y){
    this.x = x;
    this.y = y;
    this.speed = random(4,8);
  }
  update(){
    this.y += this.speed;
    this.x += wind*0.5;
    if(this.y>canvas.height) this.y = random(-100,0);
  }
  draw(){
    ctx.strokeStyle='rgba(173,216,230,0.7)';
    ctx.beginPath();
    ctx.moveTo(this.x,this.y);
    ctx.lineTo(this.x,this.y+10);
    ctx.stroke();
  }
}

// Snow particle
class Snow {
  constructor(x,y){
    this.x = x;
    this.y = y;
    this.speed = random(1,3);
    this.angle = random(0,Math.PI*2);
  }
  update(){
    this.y += this.speed;
    this.x += Math.sin(this.angle)+wind*0.2;
    this.angle += 0.01;
    if(this.y>canvas.height) this.y=random(-50,0);
  }
  draw(){
    ctx.fillStyle='rgba(255,255,255,0.9)';
    ctx.beginPath();
    ctx.arc(this.x,this.y,2,0,Math.PI*2);
    ctx.fill();
  }
}

// Mist particle
class Mist {
  constructor(x,y){
    this.x = x;
    this.y = y;
    this.alpha = random(0.1,0.3);
    this.radius = random(20,50);
  }
  update(){
    this.x += wind*0.1;
    this.y -= 0.1;
  }
  draw(){
    ctx.fillStyle=`rgba(200,200,200,${this.alpha})`;
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.radius,0,Math.PI*2);
    ctx.fill();
  }
}

// Lightning
function flashLightning(){
  lightning = true;
  setTimeout(()=>lightning=false,100);
}

// Storm spawn (on click)
class Storm {
  constructor(x,y){
    this.x = x;
    this.y = y;
    this.radius = 0;
  }
  update(){
    this.radius += 2;
    if(this.radius>150){
      this.radius = 0;
    }
  }
  draw(){
    ctx.fillStyle=`rgba(255,255,0,0.2)`;
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.radius,0,2*Math.PI);
    ctx.fill();
  }
}

// Generate clouds initially
for(let i=0;i<30;i++){
  clouds.push(new Cloud(random(0,canvas.width),random(0,canvas.height/2),random(20,50)));
}

// Event listeners
document.addEventListener('keydown', e=>{
  const key = e.key.toUpperCase();
  switch(key){
    case 'W': wind += 0.1; break;
    case 'C': cloudDensity = Math.min(cloudDensity + 0.05, 1); break;
    case 'R': rain = !rain; break;
    case 'S': snow = !snow; break;
    case 'T': flashLightning(); break;
    case 'M': mist = !mist; break;
  }
});

canvas.addEventListener('click', e=>{
  storms.push(new Storm(e.clientX,e.clientY));
});

// Animation loop
function animate(){
  // Background color based on weather
  let skyR = 135-cloudDensity*60-lightning*80;
  let skyG = 206-cloudDensity*60-lightning*80;
  let skyB = 235-cloudDensity*40-lightning*80;
  ctx.fillStyle = `rgb(${skyR},${skyG},${skyB})`;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Draw clouds
  for(let i=0;i<clouds.length;i++){
    clouds[i].update();
    clouds[i].draw();
  }

  // Draw rain
  if(rain){
    while(raindrops.length<300){
      raindrops.push(new Rain(random(0,canvas.width),random(-canvas.height,0)));
    }
    raindrops.forEach(r=>{
      r.update();
      r.draw();
    });
  }

  // Draw snow
  if(snow){
    while(snowflakes.length<150){
      snowflakes.push(new Snow(random(0,canvas.width),random(-canvas.height,0)));
    }
    snowflakes.forEach(s=>{
      s.update();
      s.draw();
    });
  }

  // Draw mist
  if(mist){
    while(mists.length<50){
      mists.push(new Mist(random(0,canvas.width),canvas.height));
    }
    mists.forEach(m=>{
      m.update();
      m.draw();
    });
  }

  // Draw storms
  storms.forEach(s=>{
    s.update();
    s.draw();
  });

  // Lightning flash
  if(lightning){
    ctx.fillStyle='rgba(255,255,255,0.3)';
    ctx.fillRect(0,0,canvas.width,canvas.height);
  }

  requestAnimationFrame(animate);
}

animate();
</script>
</body>
</html>
